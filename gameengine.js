function Interaction(e){this.changeables={};this.currentScene=0;this.currentSubscene=0;this.type="";this.assertions=["start"];this.dom=e;this.probCalculable=null;this.subprobCalcuable=[];this.sceneMap=new SceneMap;this.totalScenes=null;this.events=new EventEmitter(self);this.totalEmptyScenes=0;this.subtotalEmptyScenes=[];return this}function DynamicAppearance(e,t){this.dom=e;this.appearances={};this.currentState=[];this.defaultClass=t;this.events=new EventEmitter(self);this.unsigned=false;defaultEvents.animEnd(this);return this}function DynamicContent(e){this.dom=e;this.contents={};this.events=new EventEmitter(self);defaultEvents.animEnd(this);return this}function TemporaryContent(e,t){this.dom=e;this.specialState="";this.callbackState="";this.currentState="new";this.defaultClass=t;defaultEvents.animEnd(this);return this}function ConditionalContent(e,t){this.dom=e;this.onClass="";this.offClass="";this.startingClass=t;this.currentState=["new"];this.states=[];this.events=new EventEmitter(self);defaultEvents.animEnd(this);return this}function ControllerObject(e,t,n,r){this.dom=e;this.children;this.approval=r;this.events=new EventEmitter;this.domListeners=t;this.control=n;this.additional;return this}function EventEmitter(e){this.self=e}Interaction.prototype.initialize=function(){var e=this;this.controls={start:function(t){e.sceneMap.initialize(e.totalScenes);e.totalEmptyScenes=e.sceneMap.totalEmptyScenes;e.controls.redact("start");e.controls.forward()},forward:function(){if(e.currentScene===e.totalScenes){switch(e.type){case"linear":e.controls.assert("end");break;case"loop":e.currentScene=1;e.currentSubscene=0;break;default:break}}if(e.sceneMap.map[e.currentScene]!==undefined){if(e.currentSubscene<e.sceneMap.map[e.currentScene].length-1){e.currentSubscene++}else{if(e.sceneMap.map[e.currentScene+1]!==undefined){e.currentScene++;e.currentSubscene=0}}}if(e.currentScene==0){e.currentScene++}e.controls.updateAllContent()},backward:function(){if(e.currentScene>0){if(e.currentSubscene>0){e.currentSubscene--}else{if(e.currentScene>1){e.currentScene--;e.currentSubscene=e.sceneMap.map[e.currentScene].length-1}else if(e.currentScene==1){if(e.currentSubscene>=1){e.currentSubscene--}}}}e.controls.updateAllContent()},assert:function(t){if(typeof t=="string"){var n=simpleFunctions.inArray(t,e.assertions);if(n===false){e.assertions.push(t)}}else{for(var r=0;r<t.length;r++){var n=simpleFunctions.inArray(t[r],e.assertions);if(n===false){e.assertions.push(t[r])}}}e.controls.updateConditionalContent(e.assertions)},redact:function(t){if(typeof t=="string"){var n=simpleFunctions.inArray(t,e.assertions);if(n===true){var r=e.assertions.indexOf(t);e.assertions.splice(r,1)}}else{for(var i=0;i<t.length;i++){var n=simpleFunctions.inArray(t[i],e.assertions);if(n===true){var r=e.assertions.indexOf(t[i]);e.assertions.splice(r,1)}}}e.controls.updateConditionalContent()},approve:function(){},updateAllContent:function(){e.controls.updateDynamicContent();e.controls.updateDynamicAppearances();e.controls.updateConditionalContent()},updateDynamicContent:function(t){for(var n in e.changeables.content){e.changeables.content[n].dynamicClass(e.currentScene,e.currentSubscene)}},updateDynamicAppearances:function(){for(var t in e.changeables.appearance){e.changeables.appearance[t].dynamicClass(e.currentScene,e.currentSubscene)}if(e.sceneMap.map[e.currentScene]=="unsigned"){for(var t in e.changeables.unsigned){var n=e.changeables.unsigned[t].determineProbability(e.currentScene,e.currentSubscene,e.probability());if(n===true){break}}}},updateConditionalContent:function(){for(var t in e.changeables.conditionals){e.changeables.conditionals[t].dynamicClass(e.assertions)}}};this.events.on("dynamic-content-initialized",function(t){e.sceneMap.addToSceneMap(t)});this.events.on("dynamic-appearance-initialized",function(t){e.sceneMap.addToSceneMap(t)});this.events.on("unsigned-element",function(t){e.sceneMap.addToUnsigned(t)});this.events.on("control-given",function(t,n){e.controls[t](n)});this.events.on("probable",function(t){e.resetProbability(t)});this.type=function(e){var t=e.dom.getAttribute("data-type");return t}(e);this.resetProbability=function(t){this.changeables.appearance.push(t);this.changeables.unsigned.splice(simpleFunctions.findObject(this.changeables.unsigned,t,"index"),1);console.table(e.changeables.unsigned);this.sceneMap.totalPossibleScenes--;this.probCalculable=1;this.totalEmptyScenes--;this.changeables.unsigned=simpleFunctions.shuffleArray(this.changeables.unsigned)};this.probability=function(){var e;if(this.probCalculable==null){this.probCalculable=1}if(this.sceneMap.totalPossibleScenes>=this.probCalculable){e=this.probCalculable/this.totalEmptyScenes;this.probCalculable++}else{e=1}if(e==Infinity){e=0}return e};this.totalScenes=function(e){var t=e.dom.getAttribute("data-scenes");e.dom.removeAttribute("data-scenes");if(t===null||isNaN(Number(t))===true){return null}else{return Number(t)}}(e);this.controller=function(e){var t=[];if($(e.dom).find(".control").length){var n=$(e.dom).find(".control");var r=[];$(n).each(function(e){var i=n[e];var s=$(i).data("control").split("+");for(var o=0;o<s.length;o++){r={tempdom:i,templistener:$(i).data("control-listener"),tempcontrol:s[o],tempapprove:$(i).data("confirm")};n[e].removeAttribute("data-control");n[e].removeAttribute("data-control-listener");n[e].removeAttribute("data-confirm");var u=new ControllerObject(r.tempdom,r.templistener,r.tempcontrol,r.tempapprove);u.initialize();t.push(u)}})}else{newController=new ControllerObject(e.dom,"default","forward");newController.initialize();t.push(newController)}return t}(e);this.changeables=function(e){var t={appearance:[],content:[],conditionals:[],unsigned:[]};var n=$(e.dom).find(".dynamic");var r=$(e.dom).find(".dynamic-content");var i=$(e.dom).find(".conditional");if(i.length){for(var s=0;s<i.length;s++){var o=new ConditionalContent(i[s],i[s].getAttribute("class"));o.initialize();o.dynamicClass(e.assertions);t.conditionals.push(o)}}else{t.conditionals=[]}if(n.length){for(var s=0;s<n.length;s++){var u=new DynamicAppearance(n[s],n[s].getAttribute("class"));u.initialize();if(u.unsigned===true){t.unsigned.push(u)}else{t.appearance.push(u)}}}else{t.appearance=[]}if(r.length){for(var a=0;a<r.length;a++){var f=new DynamicContent(r[a]);f.initialize();t.content.push(f)}}else{t.content=[]}if(t.appearance===null&&t.content===null&&t.conditionals){return null}else{return t}}(e)};DynamicAppearance.prototype.initialize=function(){var e=this;this.appearances=function(e){if($(e.dom).data("scenemap")){var t=$(e.dom).data("scenemap").split(" ");var n=[];var r,i,s,o,u,a;for(var f=0;f<t.length;f++){var l=t[f].split(":");u={};r=l[0];i=0;if(isNaN(Number(r))){a=r.split("-");r=isNaN(Number(a[0]))==false?Number(a[0]):a[0];o=isNaN(Number(l[1]))==false?Number(l[1]):l[1];if(isNaN(Number(a[1]))==true){i="all";e.unsigned=a[0]=="all"?false:true;u[i]=o}else{i=Number(a[1]);u[i]=o}if(isNaN(Number(r))){r="unsigned";e.unsigned=true}else{r=Number(r)}}else{u={all:l[1]}}if(r==""){}else{if(n[r]==undefined){n[r]=[]}n[r].push(u);e.events.emit("dynamic-appearance-initialized",[r,i]);if(r=="unsigned"||i=="unsigned"){e.events.emit("unsigned-element",[r,i])}}}e.dom.removeAttribute("data-scenemap")}else{return null}return n}(e)};DynamicAppearance.prototype.dynamicClass=function(e,t){var n=this;var r=n.dom.getAttribute("class");var i=[];var s=this.appearances[e];var o;if(s!==undefined){var u=n.appearances[e];for(var a in n.appearances[e]){var f=n.appearances[e][a];if(f[t]!==undefined){r+=f[t]==null?"":" "+f[t];i.push(f[t])}if(f["all"]!==undefined){r+=f["all"]==null?"":" "+f["all"];i.push(f["all"])}}}for(var l in n.currentState){r=r.replace(" "+n.currentState[l],"")}n.dom.setAttribute("class",r);n.dom.style.animationPlayState="running";n.dom.style.webkitAnimationPlayState="running";n.currentState=i;return r};DynamicAppearance.prototype.determineProbability=function(e,t,n){var r=Math.random();if(r<n){this.appearances[e]=this.appearances["unsigned"];delete this.appearances["unsigned"];this.dynamicClass(e,t);this.events.emit("probable",this);return true}else{return false}};DynamicContent.prototype.initialize=function(){var e=this;this.contents=function(e){var t={};var n=[];var r=[];var i=$(e.dom).children(".toggle-content");for(var s=0;s<i.length;s++){var o=i[s];var u=o.getAttribute("class");var a=new TemporaryContent(o,u);var f=$(o).data("scenemap").split(":");var l,c,h;var p=f[1].split(" ");a.specialState=p[0];a.callbackState=p[1];if(isNaN(Number(l))){l=f[0].split("-");if(isNaN(Number(l[1]))==true){h=l[1]=="all"?"all":"unsigned"}else{h=Number(l[1])}if(isNaN(Number(l[0]))){c="unsigned"}else{c=Number(l[0])}}else{c=Number(l);h="all"}if(t[c]==undefined){t[c]={};t[c][h]=[]}else if(t[c][h]==undefined){t[c][h]=[]}o.removeAttribute("data-scenemap");t[c][h].push(a);e.events.emit("dynamic-content-initialized",[c,h]);if(c=="unsigned"||h=="unsigned"){e.events.emit("unsigned-element",[c,h])}}e.dom.removeAttribute("data-scenemap");return t}(e)};DynamicContent.prototype.dynamicClass=function(e,t,n){var r=this;var i=r.contents;for(var s in i){for(var o in i[s]){var u=i[s][o];for(var a in u){var f=u[a];element=f.dom;classFrom=f.defaultClass;element.setAttribute("class",classFrom);if(s==e){if(o==t||o=="all"){f.currentState="on"}else{f.currentState="off"}f.dynamicClass()}else{f.currentState="off";f.dynamicClass()}}}}};TemporaryContent.prototype.dynamicClass=function(){var e=this;var t=e.dom.getAttribute("class");if(e.currentState=="new"){return t}else if(e.currentState=="off"){t=t.replace(" "+e.specialState,"");t=t.replace(" "+e.callbackState,"");t+=e.callbackState==null?"":" "+e.callbackState}else if(e.currentState=="on"){t=t.replace(" "+e.specialState,"");t=t.replace(" "+e.callbackState,"");t+=e.specialState==null?"":" "+e.specialState}e.dom.setAttribute("class",t);return t};ConditionalContent.prototype.initialize=function(){var e=this;e.startingClass=e.dom.getAttribute("class");this.contents=function(e){var t=[];var n=[];if($(e.dom).data("condition")){var r=$(e.dom).data("condition").split(" ");var i,s,o,u,a;for(var f in r){a=r[f].split(":");o=a[0];i=a[1].split("||")[0]||null;s=a[1].split("||")[1]||null;u={};u[o]=[i,s];e.states.push(u)}}else{return null}e.dom.removeAttribute("data-condition");e.events.emit("conditional-initialized");return t}(e)};ConditionalContent.prototype.dynamicClass=function(e){var t=this;var n=t.dom.getAttribute("class");if(e===undefined||e.length===undefined){return n}else{for(var r=0;r<t.states.length;r++){for(var i in t.states[r]){var s=t.states[r][i][0];var o=t.states[r][i][1]}n=n.replace(" "+s,"");n=n.replace(" "+o,"");n+=o==null?"":" "+o;for(var u in e){if(Object.keys(t.states[r])==e[u]){n=n.replace(" "+o,"");n+=s==null?"":" "+s}}}t.dom.setAttribute("class",n);return n}};ControllerObject.prototype.initialize=function(){var e=this;this.additional=function(e){if(e.control.split(":").length>1){var t=e.control.split(":")[1];e.control=e.control.split(":")[0];return t}}(e);this.processedListeners=function(e){var t=typeof e.domListeners;switch(t){case"string":e.setSwitch(e);break;case"ojbect":for(var n=0;n<e.domListeners.length;n++){if(typeof e.domListeners=="string"){e.setSwitch(e)}}break}}(e);this.children=function(e){if(e.approval!==undefined){var t={};var n=$(e.dom).children(".approve");for(var r=0;r<n.length;r++){t[n[r].getAttribute("data-control")]=n[r];n[r].removeAttribute("data-control")}return t}else{return null}}(e)};ControllerObject.prototype.setSwitch=function(e){var t=e.domListeners;switch(t){case"default":$(e.dom).on("click",function(t){t.preventDefault();var n=e.dom.getAttribute("class");if(e.approval===undefined){e.events.emit("control-given",e.control,e.additional);return true}else{e.dom.setAttribute("class",n+" "+e.approval);$(e.children["revoke"]).on("click",function(){e.dom.setAttribute("class",n);console.log("revoke");return false});$(e.children["confirm"]).on("click",function(){e.dom.setAttribute("class",n);e.events.emit("control-given",e.control,e.additional);console.log("confirm");return false})}});break;default:$(e.dom).on(e.domListeners.toString(),function(t){t.preventDefault();var n=e.dom.getAttribute("class");if(e.approval===undefined){e.events.emit("control-given",e.control,e.additional);return true}else{e.dom.setAttribute("class",n+" "+e.approval);$(e.children["revoke"]).on(e.domListeners,function(){e.dom.setAttribute("class",n);return false});$(e.children["confirm"]).on(e.domListeners,function(){e.dom.setAttribute("class",n);e.events.emit("control-given",e.control,e.additional);return false})}});break}};var SceneMap=function(){this.map=[];this.totalEmptyScenes=0;this.subtotalEmptyScenes=[];this.totalPossibleScenes=0;this.subtotalPossibleScenes=[];this.self=this;this.totalScenes=null;this.sceneProbability=0;this.subsceneProbability=[];this.events=new EventEmitter(this.self);return this};SceneMap.prototype.initialize=function(e){var t=this;this.totalScenes=e;this.map=this.fillSceneMap();this.map=this.reduceSceneMap()};SceneMap.prototype.addToSceneMap=function(e){var t,n;if(e!==undefined){t=e[0];n=e[1];if(isNaN(t)==false&&isNaN(n)===false){if(this.map[t]==undefined){this.map[t]=[]}isInArray=simpleFunctions.inArray(n,this.map[t]);if(isInArray===false){this.map[t][n]=n}}}};SceneMap.prototype.addToUnsigned=function(e){if(e!==undefined){pref=e[0];suff=e[1];if(pref=="unsigned"){this.totalPossibleScenes+=1}if(suff=="unsigned"){if(this.subtotalPossibleScenes[pref]==undefined){this.subtotalPossibleScenes[pref]=0}this.subtotalPossibleScenes[pref]+=1}}};SceneMap.prototype.reduceSceneMap=function(){if(this.totalEmptyScenes>this.totalPossibleScenes){this.totalEmptyScenes=this.totalPossibleScenes}for(var e in this.subtotalEmptyScenes){if(this.subtotalEmptyScenes[e]>this.subtotalPossibleScenes[e]){this.subtotalPossiblities[e]=this.subtotalPossibleScenes[e]}}return this.map};SceneMap.prototype.fillSceneMap=function(){var e=this.totalScenes==null?this.map.length-1:this.totalScenes;var t=e-(this.map.length-1);if(t>0){for(var n=1;n<=this.totalScenes;n++){if(this.map[n]===undefined){this.map[n]="unsigned";this.totalEmptyScenes+=1}}}else if(t<0){for(var n=this.totalScenes+1;n<this.map.length;n++){delete this.map[n]}}else{for(var n=1;n<=e;n++){if(this.map[n]===undefined){this.map[n]="unsigned";this.totalEmptyScenes+=1}}}for(var r=1;r<this.map.length;r++){if(this.map[r]!==undefined){var i=this.map[r].length-1;var s=this.map[r][i];for(var o=0;o<s;o++){if(this.map[r][o]===undefined){this.map[r][o]="unsigned";if(this.subtotalEmptyScenes[r]==undefined){this.subtotalEmptyScenes[r]=0}this.subtotalEmptyScenes[r]+=1}}}}return this.map};var animationEnd=function(e){e.dom.addEventListener("webkitAnimationIteration",function(){this.style.animationName="";this.style.webkitAnimationName="";this.style.animationPlayState="paused";this.style.webkitAnimationPlayState="paused"},false);e.dom.addEventListener("animationIteration",function(){this.style.animationName="";this.style.webkitAnimationPlayState="paused";this.style.animationPlayState="paused"},false)};var defaultEvents={animEnd:animationEnd};EventEmitter.prototype.events=Object.create(null);EventEmitter.prototype.on=function(e,t){if(typeof this.events[e]!=="undefined"){this.events[e].push(t)}else{this.events[e]=[t]}};EventEmitter.prototype.emit=function(e){if(typeof this.events[e]!=="undefined"){var t=this.events[e];var n=t.length;var r=n;var i=Array.prototype.slice.call(arguments,1);while(r){var s=t[n-r--];s.apply(this,i)}}};arrayCheck=function(e,t){var n=t.length;for(var r=0;r<n;r++){if(t[r]==e)return true}return false};arrayShuffle=function(e){var t,n;var r=e;var i=r.length;while(i){n=Math.random()*i--|0;t=r[i];r[i]=r[n];r[n]=t}return r};arrayFind=function(e,t,n){for(var r=0;r<e.length;r++){if(e[r].dom===t.dom){if(n=="object"){return e[r]}else if(n=="index"){return r}else{return e[r]}}}throw"Couldn't find the object"};var simpleFunctions={inArray:arrayCheck,shuffleArray:arrayShuffle,findObject:arrayFind};var masterEmitter=new EventEmitter;var allTheInteractions=function(){var e=document.getElementsByClassName("interaction");var t=[];for(var n=0;n<e.length;n++){var r=new Interaction(e[n]);r.initialize();t.push(r)}return t}()